<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Fragementos tickets</title>
    </head>
    <body>
        <!--1 Filtros de histórico de tickets-->
        <section id="filtros" th:fragment="filtrosHistorico">
            <div class="panel panel-default">
                <div class="panel-body">                    
                    <!-- 2 column grid layout with text inputs for the first and last names -->
                    <form method="POST" th:action="@{/ticket/query1}"                               
                          class="was-validated">
                        <div class="card">                            
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="fechaRegistro">Fecha de registro</label>
                                    <input type="text" class="form-control" 
                                           th:value="${fecha}"
                                           th:name="fecha" 
                                           />
                                </div>                                    
                            </div>
                            <div class="card-footer text-center">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check"></i> Filtrar
                                </button>
                            </div>
                        </div>
                    </form>
                    <form method="POST" th:action="@{/ticket/query2}"                               
                          class="was-validated">
                        <div class="card">                            
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="estadoTicket">Estado</label>
                                    <input type="text" class="form-control" 
                                           th:value="${estado}"
                                           th:name="estado" 
                                           />
                                </div>

                            </div>
                            <div class="card-footer text-center">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check"></i> Filtrar
                                </button>
                            </div>
                        </div>
                    </form>
                    <form method="POST" th:action="@{/ticket/query3}"                               
                          class="was-validated">
                        <div class="card">                            
                            <div class="card-body">
                                <div class="mb-3">
                                    <label for="incidencia">Tipo de incidente</label>
                                    <input type="text" class="form-control" 
                                           th:value="${incidente}"
                                           th:name="incidente" 
                                           />
                                </div>

                            </div>
                            <div class="card-footer text-center">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-check"></i> Filtrar
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        <!--2 Listado de tickets-->
        <section id="tabla" th:fragment="listado">
            <div class="container">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <!-- 2 column grid layout with text inputs for the first and last names -->
                        <section  id="Tickets">

                            <div class="row">
                                <div class="col-md-11 mb-2">
                                    <div class="card">
                                        <div th:if="${tickets != null and !tickets.empty}">
                                            <table class="table table-striped table-hover">
                                                <thead class="table-dark">
                                                    <tr><th>Ticket</th>
                                                        <th>Fecha registro</th>
                                                        <th>Tipo incidente</th>
                                                        <th>Estado</th>
                                                        <th>Usuario registra</th>
                                                        <th>Técnico registro</th>
                                                        <th></th></tr>
                                                </thead>
                                                <tbody>
                                                    <tr th:each="ticket : ${tickets}">
                                                        <!--                                                            <td>[[${ticket.idTicket}]]</td>
                                                                                                                    <td>[[${ticket.fechaRegistroUsuario}]]</td>
                                                                                                                    <td>[[${ticket.incidencia.descripcion}]]</td>
                                                                                                                    <td>[[${ticket.estado.descripcion}]]</td>
                                                                                                                    <td>[[${ticket.usuario.username}]]</td>
                                                                                                                    <td>[[${ticket.tecnico.username}]]</td>                                                            -->
                                                        <td th:text="${ticket.idTicket}"></td>
                                                        <td th:text="${ticket.fechaRegistroUsuario}"></td>
                                                        <td th:text="${ticket.incidencia.descripcion}"></td>
                                                        <td th:text="${ticket.estado.descripcion}"></td>
                                                        <td th:text="${ticket.usuario.username}"></td>
                                                        <td th:text="${ticket.tecnico.username}"></td>  
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="text-center p-2" th:if="${tickets == null or tickets.empty}">
                                            <span>La lista se encuentra vacía</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </section>
                    </div>
                </div>
            </div>
        </section>
        <!--3 Listado de tickets de técnico-->
        <section id="tabla" th:fragment="listado2">
            <div class="container">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <!-- 2 column grid layout with text inputs for the first and last names -->
                        <section  id="Tickets">
                            <div class="container">
                                <div class="row">
                                    <div class="col-md-11 mb-2">
                                        <div class="card">
                                            <div th:if="${tickets != null and !tickets.empty}">
                                                <table class="table table-striped table-hover">
                                                    <thead class="table-dark">
                                                        <tr><th>Ticket</th>
                                                            <!--<th>Ticket</th>-->
                                                            <th>Fecha registro</th>
                                                            <th>Tipo incidente</th>
                                                            <th>Estado</th>
                                                            <th>Usuario registra</th>
                                                            <th>Técnico registro</th>
                                                            <th></th></tr>
                                                    </thead>
                                                    <tbody>
                                                        <tr th:each="ticket : ${tickets}" th:if="${ticket.tecnico.username} == 'ldiego'">
                                                            <td>[[${ticket.idTicket}]]</td>
                                                            <td>[[${ticket.fechaRegistroUsuario}]]</td>
                                                            <td>[[${ticket.incidencia.descripcion}]]</td>
                                                            <td>[[${ticket.estado.descripcion}]]</td>
                                                            <td>[[${ticket.usuario.username}]]</td>
                                                            <td>[[${ticket.tecnico.username}]]</td>
                                                            <td> <a th:href="@{/ticket/atencion/}+${ticket.idTicket}"
                                                                    class="btn btn-success">
                                                                    <i class="fas fa-pencil"></i>Atender</a></td></tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="text-center p-2" th:if="${tickets == null or tickets.empty}">
                                                <span>La lista se encuentra vacía</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </section>

        <!--Editar tickets-->
        <section id="editarTickets" th:fragment="editarTicket">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-8">
                    <form method="POST"
                          th:action="@{/ticket/guardar}" th:object="${ticket}"
                          class="was-validated"
                          enctype="multipart/form-data">
                        <input type="hidden" name="idTicket" th:field="*{idTicket}"/>
                        <input type="hidden" name="usuario.idUsuario" th:field="*{usuario.idUsuario}"/>
                        <input type="hidden" name="fechaRegistraTecnico" th:field="*{fechaRegistraTecnico}"/>
                        <input type="hidden" name="tecnico.idUsuario" th:field="*{tecnico.idUsuario}"/>
                        <input type="hidden" name="comentarioTecnico" th:field="*{comentarioTecnico}"/>
                        <section th:replace="~{UsuarioTickets/fragmentos :: botonesAtencion}"/>
                        <div id=details>
                            <div class="container">
                                <div class="row">
                                    <div class="col">
                                        <div class="card">
                                            <div class="card-header">
                                                <h4>Atención de ticket</h4>
                                            </div>
                                            <div class="card-body">
                                                <div class="mb-3">
                                                    <label for="idTicket">Número de ticket</label>
                                                    <input type="text" class="form-control" 
                                                           th:field="*{idTicket}"
                                                           readonly
                                                           disabled="true">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="usuario.username">Usuario incidente</label>
                                                    <input type="text" class="form-control" 
                                                           th:field="*{usuario.username}"
                                                           readonly
                                                           disabled="true">
                                                </div>
                                                <div class="mb-3">
                                                    <label for="estado">Estado</label>
                                                    <select th:field="*{estado.estadoTicket}"
                                                            class="form-select" 
                                                            aria-label="Default select example">
                                                        <option th:each="c : ${estadoTickets}" th:value="${c.estadoTicket}" th:text="${c.descripcion}">
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="incidencia">Tipo del incidente</label>
                                                    <select th:field="*{incidencia.incidencia}"
                                                            class="form-select" 
                                                            aria-label="Default select example">
                                                        <option th:each="c : ${incidencias}" th:value="${c.incidencia}" th:text="${c.descripcion}">
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="prioridad">Prioridad</label>
                                                    <select th:field="*{prioridad.prioridad}"
                                                            class="form-select" 
                                                            aria-label="Default select example">
                                                        <option th:each="c : ${prioridades}" th:value="${c.prioridad}" th:text="${c.descripcion}">
                                                        </option>
                                                    </select>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="titulo">Título</label>
                                                    <input type="text" class="form-control" 
                                                           th:field="*{titulo}"
                                                           readonly>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="descripcion">Descripcion</label>
                                                    <textarea rows=4
                                                              class="form-control" 
                                                              th:field="*{descripcion}"                                                               
                                                              readonly></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="comentariosUsuario">Comentarios usuario</label>
                                                    <textarea rows=4
                                                              class="form-control" 
                                                              th:field="*{comentariosUsuario}"                                                               
                                                              readonly></textarea>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="fechaRegistroUsuario">Fecha registro ticket</label>
                                                    <input type="text" class="form-control" 
                                                           th:field="*{fechaRegistroUsuario}"
                                                           readonly>
                                                </div>
                                                <div class="mb-3">
                                                    <label for="comentariosTecnico">Comentarios técnico</label>
                                                    <textarea rows=4
                                                              class="form-control" 
                                                              th:field="*{comentariosTecnico}"
                                                              required="True"
                                                              readonly></textarea>
                                                </div>
                                            </div>                                           
                                            <div class="form-outline mb-4">
                                                <!-- Submit button -->
                                                <button type="submit" class="btn btn-primary btn-block mb-2">Actualizar ticket</button>
                                            </div> 
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </section>
        <!--botones atención de caso-->
        <section th:fragment="botonesAtencion">
            <div class="container py-4 mb-4 bg-light">
                <div class="row">
                    <div class="col-md-4 d-grid">
                        <a th:href="@{/ticket/listado/asignados}" class="btn btn-primary">
                            <i class="fas fa-arrow-left"></i> Regresar
                        </a>
                    </div>
                    <div class="col-md-4 d-grid">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check"></i> Guardar
                        </button>
                    </div>
                </div>
            </div>
        </section>
    </body>
</html>
